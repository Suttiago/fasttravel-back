{% include "components/head.html"%}

<body class="bg-dark text-white">
  {% include "components/header.html"%}

  <div class="container" style="margin-top: 100px;">

    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">Meus Dependentes</h2>
      <!-- Botão para abrir modal de cadastro -->
      <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#cadastroDependenteModal">
        + Adicionar Dependente
      </button>
    </div>

    {% if dependentes %}
    <div class="table-responsive">
      <table class="table table-dark table-striped table-bordered align-middle">
        <thead>
          <tr>
            <th>Nome</th>
            <th>CPF</th>
            <th>Data de Nascimento</th>
            <th>Sexo</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for dependente in dependentes %}
          <tr>
            <td>{{ dependente.nome }}</td>
            <td>{{ dependente.cpf }}</td>
            <td>{{ dependente.data_nascimento }}</td>
            <td>{{ dependente.sexo }}</td>
            <td>
              <!-- Excluir -->
              <form action="{{ url_for('pessoa.excluir_dependentes', dependente_id=dependente.id) }}" method="POST"
                style="display:inline;">
                <button type="submit" class="btn btn-danger btn-sm"
                  onclick="return confirm('Tem certeza que deseja excluir este dependente?');">
                  <i class="bi bi-trash"></i>
                </button>
              </form>

              <!-- Editar -->
              <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal"
                data-bs-target="#editarDependenteModal" data-bs-id="{{ dependente.id }}"
                data-bs-nome="{{ dependente.nome }}" data-bs-cpf="{{ dependente.cpf }}"
                data-bs-data_nascimento="{{ dependente.data_nascimento }}"
                data-bs-sexo="{{ dependente.sexo }}">
                <i class="bi bi-pencil-square"></i>
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-center">Nenhum dependente cadastrado.</p>
    {% endif %}
  </div>

  <!-- Modal de Cadastro -->
  <div class="modal fade" id="cadastroDependenteModal" tabindex="-1"
    aria-labelledby="cadastroDependenteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form action="/CadastroDependentes" method="POST">
        <div class="modal-content bg-dark text-white">
          <div class="modal-header">
            <h5 class="modal-title" id="cadastroDependenteModalLabel">Cadastrar Dependente</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
              aria-label="Fechar"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="nome" class="form-label">Nome</label>
              <input type="text" class="form-control" id="nome" name="nome" required>
            </div>
            <div class="mb-3">
              <label for="cpf" class="form-label">CPF</label>
              <input type="text" class="form-control" id="cpf" name="cpf" required>
            </div>
            <div class="mb-3">
              <label for="data_nascimento" class="form-label">Data de Nascimento</label>
              <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" required>
            </div>
            <div class="mb-3">
              <label for="sexo" class="form-label">Sexo</label>
              <select class="form-select" id="sexo" name="sexo" required>
                <option value="">Selecione</option>
                <option value="Masculino">Masculino</option>
                <option value="Feminino">Feminino</option>
                <option value="Outro">Outro</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-secondary">Cadastrar</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Edição -->
  <div class="modal fade" id="editarDependenteModal" tabindex="-1"
    aria-labelledby="editarDependenteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form method="POST" id="formEditarDependente">
        <div class="modal-content bg-dark text-white">
          <div class="modal-header">
            <h5 class="modal-title" id="editarDependenteModalLabel">Editar Dependente</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
              aria-label="Fechar"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" name="dependente_id" id="edit-dependente-id">
            <div class="mb-3">
              <label for="edit-nome" class="form-label">Nome</label>
              <input type="text" class="form-control" id="edit-nome" name="nome" required>
            </div>
            <div class="mb-3">
              <label for="edit-cpf" class="form-label">CPF</label>
              <input type="text" class="form-control" id="edit-cpf" name="cpf" required>
            </div>
            <div class="mb-3">
              <label for="edit-data_nascimento" class="form-label">Data de Nascimento</label>
              <input type="date" class="form-control" id="edit-data_nascimento" name="data_nascimento" required>
            </div>
            <div class="mb-3">
              <label for="edit-sexo" class="form-label">Sexo</label>
              <select class="form-select" id="edit-sexo" name="sexo" required>
                <option value="Masculino">Masculino</option>
                <option value="Feminino">Feminino</option>
                <option value="Outro">Outro</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-secondary">Salvar Alterações</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script>
    const editarDependenteModal = document.getElementById('editarDependenteModal');

    editarDependenteModal.addEventListener('show.bs.modal', function (event) {
      const button = event.relatedTarget;
      if (!button) return;

      // Pegando os dados do botão
      const id = button.getAttribute('data-bs-id');
      const nome = button.getAttribute('data-bs-nome');
      const cpf = button.getAttribute('data-bs-cpf');
      const dataNascimento = button.getAttribute('data-bs-data_nascimento');
      const sexo = button.getAttribute('data-bs-sexo');

      // Inserindo nos campos do modal
      document.getElementById('edit-dependente-id').value = id;
      document.getElementById('edit-nome').value = nome;
      document.getElementById('edit-cpf').value = cpf;
      document.getElementById('edit-data_nascimento').value = dataNascimento;
      document.getElementById('edit-sexo').value = sexo;

      // Atualiza a action do formulário dinamicamente
      document.getElementById('formEditarDependente').action = "/EditarDependente/" + id;
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
